# 네이버 지도 API 설정 가이드

## 📋 개요

네이버 지도 API를 사용하기 위해 필요한 설정 단계를 안내합니다.

---

## 🔑 Step 1: 네이버 클라우드 플랫폼 가입

### ⚠️ 중요: 개인 회원가입 가능
**사업자 등록증이 없어도 개인 회원으로 가입할 수 있습니다!**
- 네이버 클라우드 플랫폼은 **개인 회원**과 **기업 회원** 모두 지원
- **AI·NAVER API는 개인 회원도 사용 가능**
- 사업자 등록증은 **기업 회원가입 시에만** 필요

### 1-1. 네이버 클라우드 플랫폼 접속
1. 브라우저에서 **https://www.ncloud.com** 접속
2. 우측 상단 **"회원가입"** 클릭

### 1-2. 회원가입 진행 (개인 회원)
1. **"개인 회원"** 선택 (기업 회원이 아님)
2. **이메일 또는 네이버 계정**으로 가입
3. **본인인증** 진행:
   - 휴대폰 인증 (SMS 인증)
   - 또는 공동인증서 인증
4. **약관 동의** 후 가입 완료

**소요 시간**: 약 5-10분

### 1-3. 개인 회원가입 시 필요한 정보
- 이메일 주소 또는 네이버 계정
- 휴대폰 번호 (본인인증용)
- 이름, 생년월일 (본인인증 시)
- **사업자 등록증 불필요** ✅

---

## 🎯 Step 2: 프로젝트 생성

### 2-1. 콘솔 접속
1. 로그인 후 **"Console"** 클릭
2. 좌측 메뉴에서 **"Services"** → **"AI·NAVER API"** 선택

### 2-2. 프로젝트 생성
1. **"프로젝트 생성"** 버튼 클릭
2. 프로젝트 정보 입력:
   - **프로젝트 이름**: `한의사 방문 진료 앱` (또는 원하는 이름)
   - **프로젝트 설명**: `주소 검색을 위한 네이버 지도 API 프로젝트`
3. **"생성"** 버튼 클릭

**소요 시간**: 약 2분

---

## 🔐 Step 3: API 인증키 발급

### 3-1. AI·NAVER API 서비스 선택
1. 생성한 프로젝트 클릭
2. **"AI·NAVER API"** 섹션에서 **"Application 등록"** 클릭

### 3-2. Application 등록
1. **"Application 이름"** 입력: `주소 검색 API`
2. **"Service 선택"** 섹션에서:
   - ⚠️ **중요**: 현재 화면에 보이는 서비스 목록을 **아래로 스크롤**하세요
   - **"NAVER Services"** 섹션을 확인하세요
   - 다음 서비스를 찾아서 체크:
     - ✅ **"Maps"** 또는 **"Geocoding"** (주소 → 좌표 변환)
     - ✅ **"Reverse Geocoding"** (좌표 → 주소 변환) - 선택사항
   
   **⚠️ 주의**: 
   - 현재 화면에 CLOVA, CAPTCHA, Search Trend만 보인다면
   - 서비스 목록을 **아래로 스크롤**하여 **"Maps"** 또는 **"Geocoding"**을 찾으세요
   - 만약 찾을 수 없다면, 카카오 API 사용을 권장합니다 (아래 참고)

3. **"등록"** 버튼 클릭

### 3-3. 인증키 확인
등록 완료 후 다음 정보가 표시됩니다:
- **Client ID** (예: `your_client_id_here`)
- **Client Secret** (예: `your_client_secret_here`)

⚠️ **중요**: 이 정보를 안전하게 보관하세요. 나중에 다시 확인할 수 있지만, 처음에 복사해두는 것이 좋습니다.

**소요 시간**: 약 3분

---

## ⚙️ Step 4: 서버 환경 변수 설정

### 4-1. 서버 `.env` 파일 수정
`server/.env` 파일을 열고 다음 내용을 추가합니다:

```env
# 네이버 지도 API
NAVER_MAP_CLIENT_ID=your_client_id_here
NAVER_MAP_CLIENT_SECRET=your_client_secret_here
```

**예시**:
```env
NAVER_MAP_CLIENT_ID=abc123def456ghi789
NAVER_MAP_CLIENT_SECRET=xyz789uvw456rst123
```

### 4-2. `.env` 파일 위치 확인
- 파일 경로: `server/.env`
- 파일이 없다면 `server/.env.example`을 복사하여 생성

### 4-3. 환경 변수 적용
서버를 재시작하면 환경 변수가 적용됩니다:

```bash
cd server
npm start
```

**소요 시간**: 약 2분

---

## ✅ Step 5: 테스트

### 5-1. 서버 실행 확인
```bash
cd server
npm start
```

서버가 정상적으로 시작되면:
```
🚀 API server running on port 8080 (development)
```

### 5-2. API 테스트 (선택사항)
브라우저나 Postman에서 테스트:

```
GET http://localhost:8080/api/addresses/search?query=서울시 강남구
Headers:
  Authorization: Bearer {your_jwt_token}
```

### 5-3. 앱에서 테스트
1. Flutter 앱 실행
2. 홈 화면에서 **"주소를 입력해주세요"** 버튼 클릭
3. 주소 검색 화면에서 주소 입력
4. 검색 결과가 나타나는지 확인

---

## 🔍 문제 해결

### 문제 1: "네이버 지도 API가 설정되지 않았습니다" 오류

**원인**: 환경 변수가 설정되지 않았거나 서버가 재시작되지 않음

**해결 방법**:
1. `server/.env` 파일에 `NAVER_MAP_CLIENT_ID`와 `NAVER_MAP_CLIENT_SECRET`가 있는지 확인
2. 서버를 재시작
3. 환경 변수 이름이 정확한지 확인 (대소문자 구분)

---

### 문제 2: "네이버 지도 API 키가 유효하지 않습니다" 오류 (401)

**원인**: API 키가 잘못되었거나 만료됨

**해결 방법**:
1. 네이버 클라우드 플랫폼 콘솔에서 Client ID와 Client Secret 재확인
2. `.env` 파일의 값이 정확한지 확인 (공백, 따옴표 등 제거)
3. API 키를 다시 복사하여 붙여넣기

---

### 문제 3: "주소 검색에 실패했습니다" 오류

**원인**: 
- 네이버 API 서버 문제
- 네트워크 연결 문제
- API 할당량 초과

**해결 방법**:
1. 네이버 클라우드 플랫폼 콘솔에서 API 사용량 확인
2. 네트워크 연결 확인
3. 서버 로그 확인

---

## 📊 API 사용량 확인

### 네이버 클라우드 플랫폼에서 확인
1. 콘솔 → **"Services"** → **"AI·NAVER API"**
2. 프로젝트 선택
3. **"사용량"** 탭에서 일일/월간 사용량 확인

### 무료 할당량
- **Geocoding**: 월 300만 건까지 무료
- **Reverse Geocoding**: 월 300만 건까지 무료

---

## 🔒 보안 주의사항

### ⚠️ 중요
1. **`.env` 파일을 Git에 커밋하지 마세요**
   - `.gitignore`에 `.env`가 포함되어 있는지 확인
2. **API 키를 코드에 하드코딩하지 마세요**
   - 항상 환경 변수로 관리
3. **프로덕션 환경에서는 더 강력한 보안 조치를 적용하세요**

---

## 📝 체크리스트

설정 완료 확인:

- [ ] 네이버 클라우드 플랫폼 가입 완료
- [ ] 프로젝트 생성 완료
- [ ] Application 등록 완료
- [ ] Client ID 발급 완료
- [ ] Client Secret 발급 완료
- [ ] `server/.env` 파일에 환경 변수 추가 완료
- [ ] 서버 재시작 완료
- [ ] 앱에서 주소 검색 테스트 성공

---

## 🎯 다음 단계

설정이 완료되면:
1. ✅ 주소 검색 기능이 정상 작동하는지 확인
2. ✅ 예약 화면에 주소 선택 기능 통합 (자동으로 진행됨)
3. ✅ 필요 시 추가 기능 구현 (최근 검색 주소 저장 등)

---

## 📚 참고 자료

- [네이버 클라우드 플랫폼 공식 문서](https://www.ncloud.com/product/applicationService/maps)
- [네이버 지도 API 가이드](https://api.ncloud-docs.com/docs/ai-naver-mapsgeocoding-geocode)
- [Geocoding API 문서](https://api.ncloud-docs.com/docs/ai-naver-mapsgeocoding-geocode)

---

## 💡 팁

1. **테스트 환경과 프로덕션 환경 분리**
   - 개발용과 운영용 API 키를 별도로 발급받는 것을 권장

2. **API 사용량 모니터링**
   - 정기적으로 사용량을 확인하여 할당량 초과를 방지

3. **에러 처리**
   - API 호출 실패 시 사용자에게 친화적인 메시지 표시

---

**설정 중 문제가 발생하면 위의 "문제 해결" 섹션을 참고하거나, 네이버 클라우드 플랫폼 고객지원에 문의하세요.**

---

## ❓ 사업자 등록증이 없어도 되나요?

### ✅ 네, 개인 회원으로 가입 가능합니다!

**중요 사항**:
- 네이버 클라우드 플랫폼은 **개인 회원**과 **기업 회원** 모두 지원합니다
- **AI·NAVER API는 개인 회원도 사용 가능**합니다
- 사업자 등록증은 **기업 회원가입 시에만** 필요합니다

### 개인 회원가입 방법
1. 회원가입 화면에서 **"개인 회원"** 선택 (기업 회원 아님)
2. 이메일 또는 네이버 계정으로 가입
3. 본인인증 진행 (휴대폰 인증)
4. 약관 동의 후 가입 완료

### 개인 회원가입이 어려운 경우
- **대안 1**: 카카오 주소 검색 API 사용 (더 쉬운 가입) - `docs/address_api_alternatives.md` 참고
- **대안 2**: 공공데이터포털 주소 검색 API 사용 (완전 무료) - `docs/address_api_alternatives.md` 참고

자세한 대안 가이드는 `docs/address_api_alternatives.md`를 참고하세요.

