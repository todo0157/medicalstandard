# Ver1.3.7 코드베이스 분석 및 개선 계획

## 📋 현재 상태 요약

### ✅ 구현 완료된 핵심 기능
1. **회원가입 & 인증**
   - 이메일 기반 회원가입 (pre-signup 인증 포함)
   - 로그인/로그아웃
   - 비밀번호 재설정
   - 카카오 로그인 (UI 준비됨, TODO 주석 존재)
   - JWT 기반 세션 관리

2. **한의사 찾기 & 예약**
   - 위치 기반 한의사 검색
   - 거리 계산 (Haversine)
   - 슬롯 조회 및 예약
   - 예약 취소 기능

3. **실시간 채팅**
   - WebSocket 기반 양방향 통신
   - 채팅 세션 관리
   - 메시지 전송/수신

4. **프로필 & 진료 기록**
   - 프로필 조회/수정
   - 프로필 이미지 업로드 (Data URL 방식)
   - 진료 기록 조회
   - 의료진 인증 상태 관리

---

## 🔴 긴급 개선 필요 사항

### 1. **프로필 이미지 스토리지**
**현재 상태**: Data URL로 DB에 직접 저장 (비효율적, 용량 제한)
**문제점**:
- DB 용량 급증
- 이미지 크기 제한 없음
- CDN/캐싱 불가능
- 성능 저하

**개선 계획**:
```
1단계: 파일 스토리지 서비스 연동
  - AWS S3 / Google Cloud Storage / Cloudinary 선택
  - 서버에 이미지 업로드 엔드포인트 수정
  - 업로드 후 URL만 DB에 저장

2단계: 이미지 최적화
  - 리사이징 (썸네일 생성)
  - 압축 (WebP 변환)
  - 클라이언트에서 이미지 선택 시 크기 제한

3단계: CDN 연동
  - CloudFront / Cloudflare 연동
  - 캐싱 정책 설정
```

**예상 작업 시간**: 2-3일

---

### 2. **알림 시스템 부재**
**현재 상태**: UI에 알림 아이콘만 존재, 실제 기능 없음
**필요 기능**:
- 예약 확정/취소 알림
- 채팅 메시지 알림
- 예약 리마인더
- 진료 기록 업데이트 알림

**개선 계획**:
```
1단계: 인앱 알림
  - 서버에 알림 API 추가 (/notifications)
  - 클라이언트에 알림 목록 화면
  - 읽음/읽지 않음 상태 관리

2단계: 푸시 알림 (모바일)
  - Firebase Cloud Messaging (FCM) 연동
  - Web Push API (웹)
  - 알림 권한 요청

3단계: 이메일 알림
  - 예약 확정 시 이메일 발송
  - 예약 24시간 전 리마인더
```

**예상 작업 시간**: 3-4일

---

### 3. **"생활" 탭 미구현**
**현재 상태**: "Coming Soon" 텍스트만 표시
**제안 기능**:
- 건강 정보/팁
- 한의학 관련 콘텐츠
- 생활 습관 추적
- 건강 일기

**개선 계획**:
```
옵션 A: 건강 정보 피드
  - 한의학 관련 아티클
  - 건강 팁 카드
  - 계절별 건강 관리법

옵션 B: 건강 일기
  - 증상 기록
  - 약 복용 기록
  - 생활 패턴 추적

옵션 C: 간단한 대시보드
  - 최근 예약 요약
  - 건강 통계
  - 빠른 액션 버튼
```

**예상 작업 시간**: 2-5일 (선택한 기능에 따라)

---

## 🟡 중요 개선 사항

### 4. **주소 검색 기능 미연동**
**현재 상태**: 홈 화면에 주소 입력 버튼만 존재, API 연동 없음
**개선 계획**:
```
1단계: 카카오 주소 검색 API 연동
  - Kakao 주소 검색 API 키 발급
  - 주소 검색 모달 구현
  - 선택한 주소를 예약에 반영

2단계: 자동 완성
  - 입력 시 실시간 주소 제안
  - 최근 사용 주소 저장
```

**예상 작업 시간**: 1-2일

---

### 5. **환자 관리 기능 미완성**
**현재 상태**: 홈 화면에서 환자 추가 UI만 존재, 실제 저장/관리 기능 없음
**개선 계획**:
```
1단계: 환자 프로필 모델 추가
  - UserProfile에 관계 추가 (가족 구성원)
  - 또는 별도 Patient 모델 생성

2단계: 환자 CRUD 기능
  - 환자 추가/수정/삭제
  - 환자별 예약 관리
  - 환자별 진료 기록 조회

3단계: 권한 관리
  - 본인/가족 구성원 구분
  - 가족 구성원 추가 시 인증 필요
```

**예상 작업 시간**: 3-4일

---

### 6. **예약 관리 기능 강화**
**현재 상태**: 예약 생성/취소만 가능
**부족한 기능**:
- 예약 수정 (시간 변경)
- 예약 상세 정보
- 예약 히스토리
- 예약 상태 (대기/확정/완료/취소)

**개선 계획**:
```
1단계: 예약 상태 관리
  - 서버에 상태 필드 추가
  - 상태별 필터링

2단계: 예약 수정 기능
  - 시간/날짜 변경
  - 증상/메모 수정
  - 변경 이력 저장

3단계: 예약 상세 화면
  - 한의사 정보
  - 예약 상세 정보
  - 지도 표시
  - 연락처 정보
```

**예상 작업 시간**: 2-3일

---

### 7. **검색 및 필터링 기능 부족**
**현재 상태**: 한의사 이름 검색만 가능
**개선 계획**:
```
1단계: 고급 검색
  - 전문 분야 필터
  - 거리별 정렬
  - 평점별 정렬
  - 가격 범위 필터

2단계: 검색 결과 개선
  - 지도 뷰 옵션
  - 리스트/그리드 뷰 전환
  - 정렬 옵션
```

**예상 작업 시간**: 2일

---

### 8. **리뷰 및 평점 시스템 부재**
**현재 상태**: 리뷰/평점 기능 없음
**개선 계획**:
```
1단계: 리뷰 모델 추가
  - Review 모델 (Prisma)
  - 평점 (1-5점)
  - 리뷰 텍스트
  - 리뷰 이미지

2단계: 리뷰 CRUD API
  - 리뷰 작성 (예약 완료 후)
  - 리뷰 조회
  - 리뷰 수정/삭제

3단계: UI 구현
  - 한의사 상세에 평점 표시
  - 리뷰 목록
  - 리뷰 작성 화면
```

**예상 작업 시간**: 3-4일

---

## 🟢 추가 기능 제안

### 9. **결제 시스템**
**현재 상태**: 결제 기능 없음
**개선 계획**:
```
1단계: 결제 게이트웨이 선택
  - 토스페이먼츠 / 이니시스 / 아임포트
  - 테스트 환경 구축

2단계: 결제 API 연동
  - 예약 시 결제
  - 결제 내역 저장
  - 환불 처리

3단계: UI 구현
  - 결제 화면
  - 결제 내역 조회
  - 영수증 발급
```

**예상 작업 시간**: 5-7일

---

### 10. **의료진 대시보드**
**현재 상태**: 의료진용 전용 화면 없음
**개선 계획**:
```
1단계: 의료진 전용 라우트
  - 의료진 로그인 시 다른 홈 화면
  - 예약 관리 대시보드

2단계: 예약 관리
  - 예약 목록 (대기/확정/완료)
  - 예약 상세 및 수정
  - 일정 캘린더 뷰

3단계: 진료 기록 관리
  - 진료 기록 작성
  - 환자별 기록 조회
  - 통계 및 리포트
```

**예상 작업 시간**: 5-7일

---

### 11. **건강보험 연동**
**현재 상태**: "Coming Soon" 화면만 존재
**개선 계획**:
```
1단계: 건강보험 정보 입력
  - 보험 정보 저장
  - 보험 카드 이미지 업로드

2단계: 보험 적용 계산
  - 본인부담금 계산
  - 보험 적용 여부 표시
```

**예상 작업 시간**: 2-3일

---

### 12. **고객지원 & 법적 고지**
**현재 상태**: "Coming Soon" 화면만 존재
**개선 계획**:
```
1단계: 고객지원
  - FAQ 화면
  - 1:1 문의하기
  - 공지사항

2단계: 법적 고지
  - 이용약관
  - 개인정보처리방침
  - 서비스 정책
```

**예상 작업 시간**: 2-3일

---

## 🎨 UI/UX 개선 사항

### 13. **로딩 상태 개선**
**현재 상태**: 기본 CircularProgressIndicator 사용
**개선 계획**:
- 스켈레톤 UI 추가
- 진행률 표시 (업로드 등)
- 로딩 메시지 개선

---

### 14. **에러 처리 개선**
**현재 상태**: 기본 에러 메시지 표시
**개선 계획**:
- 사용자 친화적 에러 메시지
- 재시도 버튼 추가
- 오프라인 상태 감지 및 처리

---

### 15. **접근성 개선**
**개선 계획**:
- 스크린 리더 지원
- 키보드 네비게이션
- 색상 대비 개선
- 폰트 크기 조절 옵션

---

### 16. **다국어 지원**
**현재 상태**: 한국어만 지원
**개선 계획**:
- Flutter intl 패키지 활용
- 영어 번역 추가
- 언어 전환 기능

---

## 🔒 보안 및 성능 개선

### 17. **보안 강화**
**개선 계획**:
- API 요청 레이트 리미팅
- 입력값 검증 강화
- XSS/CSRF 방지
- 민감 정보 암호화

---

### 18. **성능 최적화**
**개선 계획**:
- 이미지 캐싱 (cached_network_image 활용)
- API 응답 캐싱
- 무한 스크롤 최적화
- 번들 크기 최적화

---

### 19. **오프라인 지원**
**개선 계획**:
- 로컬 데이터베이스 (Hive/SQLite)
- 오프라인 모드 감지
- 데이터 동기화

---

## 📱 모바일 앱 전환 준비

### 20. **네이티브 기능 연동**
**개선 계획**:
- 카메라/갤러리 접근 (이미지 선택)
- 위치 서비스 권한 처리
- 푸시 알림 설정
- 딥링크 처리

---

## 📊 우선순위별 작업 계획

### Phase 1: 긴급 (1-2주)
1. 프로필 이미지 스토리지 개선
2. 알림 시스템 기본 구현
3. 주소 검색 API 연동
4. 예약 관리 기능 강화

### Phase 2: 중요 (2-3주)
5. 환자 관리 기능
6. 검색 및 필터링 개선
7. 리뷰 및 평점 시스템
8. "생활" 탭 구현

### Phase 3: 추가 기능 (3-4주)
9. 결제 시스템
10. 의료진 대시보드
11. 건강보험 연동
12. 고객지원 & 법적 고지

### Phase 4: 최적화 (1-2주)
13. UI/UX 개선
14. 보안 및 성능 최적화
15. 오프라인 지원
16. 모바일 앱 전환 준비

---

## 📝 참고 사항

### 기술 스택 제안
- **이미지 스토리지**: Cloudinary (무료 티어 제공, 자동 최적화)
- **푸시 알림**: Firebase Cloud Messaging
- **주소 검색**: 카카오 주소 검색 API
- **결제**: 토스페이먼츠 (한국 시장 점유율 높음)
- **로컬 DB**: Hive (Flutter 친화적)

### 데이터베이스 스키마 확장 필요
- `Notification` 모델
- `Review` 모델
- `Patient` 모델 (또는 UserProfile 확장)
- `Payment` 모델
- `Address` 모델

### API 엔드포인트 추가 필요
- `/notifications` (알림)
- `/reviews` (리뷰)
- `/patients` (환자 관리)
- `/payments` (결제)
- `/addresses` (주소 검색)

---

## 🎯 MVP 출시를 위한 최소 요구사항

현재 상태로도 **기본 MVP는 출시 가능**하지만, 다음 항목을 추가하면 사용자 경험이 크게 개선됩니다:

1. ✅ 프로필 이미지 스토리지 개선
2. ✅ 알림 시스템 기본 구현
3. ✅ 주소 검색 API 연동
4. ✅ 예약 관리 기능 강화
5. ✅ 리뷰 및 평점 시스템

이 5가지만 추가하면 **완성도 높은 MVP**가 됩니다.


