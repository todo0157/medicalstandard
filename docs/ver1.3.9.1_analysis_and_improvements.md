# Ver1.3.9.4 코드베이스 분석 및 개선 계획

## 📋 현재 상태 요약

### ✅ 구현 완료된 핵심 기능 (ver1.3.9.4 기준)

1. **회원가입 & 인증 및 한의사 관리**
   - 이메일 기반 회원가입 (pre-signup 인증 포함)
   - JWT 기반 세션 관리 및 비밀번호 재설정
   - **한의사 인증 프로세스 완전 구현**: 
     - 한의사 인증 신청 UI 및 자격증 이미지 업로드 기능
     - **관리자 대시보드**: HTML/JS 기반의 독립적 관리자 시스템 (로그인, 신청 목록, 상세 검토, 승인/거부)
     - **인증 상태 동기화**: 승인 시 `Doctor` 레코드 자동 생성, 거부 시 목록에서 즉시 제외 (`isVerified` 필드 활용)

2. **한의사 찾기 & 예약 시스템**
   - 위치 기반 한의사 검색 및 거리 계산 (Haversine)
   - **주소 시스템 고도화**: 네이버 지도 API 연동 + 로컬 우편번호 DB 통합 검색
   - **예약 관리 강화**: 
     - 예약 생성, 취소 및 **수정(시간/내용 변경)** 기능 완료
     - 예약 수정 시 한의사 변경 가능 (변경 시 경고 안내 팝업 및 이전 채팅 내역 자동 관리)

3. **실시간 채팅 및 예약 연동**
   - WebSocket 기반 양방향 실시간 채팅
   - **예약-채팅 자동 연동 (ver1.3.9.4)**: 
     - 예약 완료 시 한의사와의 채팅방 자동 생성
     - 예약 시 입력한 '증상 및 요청사항'이 채팅방 첫 메시지로 자동 전달
     - 예약 수정 시 변경 사항이 채팅방에 알림 메시지로 기록
   - **UI 모드 최적화**: 환자/한의사 모드에 따른 메시지 읽음 처리 및 안 읽은 메시지 수 표시 개선

4. **프로필 및 진료 기록**
   - 프로필 조회/수정 및 이미지 관리
   - 의료진 전용 진료 기록 생성 및 권한 검증

---

## 🔴 긴급 개선 필요 사항

### 1. **프로필 이미지 스토리지 최적화**
**현재 상태**: 자격증 및 프로필 이미지를 Data URL(Base64) 형식으로 DB에 직접 저장 중
**문제점**:
- DB 용량 급증 및 성능 저하 원인
- 이미지 캐싱 불가능
**개선 계획**:
- AWS S3 또는 Cloudinary와 같은 외부 파일 스토리지 연동
- DB에는 이미지의 URL 경로만 저장하도록 구조 변경

### 2. **알림 시스템(Notification) 실제 구현**
**현재 상태**: UI에 아이콘만 존재하며, 서버 알림 로직은 부재
**필요 기능**:
- **예약 관련**: 한의사에게 예약 접수 알림, 환자에게 예약 확정/취소 알림
- **채팅 관련**: 앱 종료 상태에서도 메시지 수신 확인을 위한 푸시 알림
**개선 계획**:
- Firebase Cloud Messaging(FCM) 연동
- 인앱 알림 목록 및 읽음 상태 관리 기능 추가

### 3. **"생활" 탭 콘텐츠 구현**
**현재 상태**: "Coming Soon" 상태
**개선 계획**:
- 사용자 맞춤형 한의학 건강 정보 피드 제공
- 간단한 건강 일기 또는 증상 기록 기능 추가

---

## 🟡 중요 개선 사항

### 4. **환자 관리(가족 추가) 기능**
**현재 상태**: 홈 화면에 UI 요소만 존재
**개선 계획**:
- 한 계정에서 여러 명(본인, 부모님, 자녀 등)의 환자 프로필을 관리할 수 있는 모델 구축
- 예약 시 진료받을 환자를 선택하는 프로세스 추가

### 5. **리뷰 및 평점 시스템**
**현재 상태**: 기능 없음
**개선 계획**:
- 진료 완료 후 환자가 한의사에 대한 리뷰 및 평점을 남기는 기능
- 한의사 찾기 목록에서 평점 순 정렬 필터 추가

### 6. **결제 시스템 도입**
**현재 상태**: 비용 안내만 표시됨
**개선 계획**:
- 토스페이먼츠 등 국내 결제 게이트웨이(PG) 연동
- 예약 시 선결제 또는 진료 후 결제 프로세스 확립

---

## 🎨 UI/UX 및 기술적 최적화

### 7. **성능 및 보안**
- **이미지 캐싱**: `cached_network_image`를 통한 네트워크 이미지 로딩 최적화
- **보안**: API 요청 레이트 리미팅(Rate Limiting) 및 민감 데이터 암호화 강화
- **에러 처리**: 네트워크 단절 시 사용자 친화적인 안내 및 재시도 버튼 도입

### 8. **모바일 앱 전환 준비**
- 네이티브 카메라/갤러리 연동 최적화
- 위치 서비스 권한 요청 및 백그라운드 동작 처리

---

## 📊 우선순위별 작업 계획

### Phase 1: 안정화 및 최적화 (1-2주)
1. **프로필/자격증 이미지 외부 스토리지 이전**
2. **FCM 기반 푸시 알림 시스템 구축**
3. **진료 기록 관리 UI 고도화**

### Phase 2: 기능 확장 (2-3주)
4. **리뷰 및 평점 시스템 구현**
5. **환자(가족) 관리 기능 완성**
6. **"생활" 탭 건강 정보 연동**

### Phase 3: 상용화 준비 (3-4주)
7. **결제 시스템 연동**
8. **건강보험 적용 로직 검토**
9. **약관 및 고객지원 센터 구축**

---

## 📝 참고 사항 (ver1.3.9.4 변경점 반영)
- 이제 예약 수정 시 한의사를 변경하면 채팅방이 자동으로 정리되므로, 데이터 무결성이 향상되었습니다.
- 한의사 인증 거부 시 즉시 목록에서 제외되는 로직이 추가되어 관리 효율성이 증대되었습니다.
- **MVP 출시**를 위해 가장 시급한 것은 **알림 시스템**과 **이미지 스토리지 개선**입니다.
